<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.github.xujiaji.mk.community.mapper.MkCommunityNoticeMapper">

    <select id="selectCommentNotice" resultType="com.github.xujiaji.mk.community.dto.CommentNoticeDTO">
        SELECT
            cn.*,
            cn.from_user_id user_id,
            IF(f.state = 0, f.path, NULL) avatar,
            u.nickname,
            IF(cn.type = 0,'评论了你的故事','回复了你的评论') description,
            cc.content content,
            cn.to_user_id target_user_id,
            u2.nickname target_user_name,
            IF(cn.type = 0,ca.content,cc.content) target_content
        FROM mk_community_notice cn
                 LEFT JOIN mk_user u ON cn.from_user_id = u.id
                 LEFT JOIN mk_user u2 ON cn.to_user_id = u2.id
                 LEFT JOIN mk_file f ON u.avatar = f.id
                 LEFT JOIN mk_community_article ca ON ca.id = cn.target_id
                 LEFT JOIN mk_community_comment cc ON cc.id = cn.target_id
        WHERE cn.to_user_id = ${userId} AND (cn.type = 0 OR cn.type = 1) ORDER BY cn.create_time DESC
    </select>
</mapper>
